# 監査プランシート

## 監査項目リスト（Anchor向け）

以下の監査項目を元に、各攻撃ベクトルが今回の監査対象になるか判断し、「対象・非対象」列を記入しました。

| 番号 | 攻撃ベクトル名                                     | 対象条件                | 対象・非対象 |
|------|----------------------------------------------------|---------------------------------------|--------------|
| 00   | Signer Authorization（署名者の権限検証不足）        | 全ファイル                            | 対象 |
| 01   | Account Data Matching（アカウントデータ整合性）     | 全ファイル                            | 対象 |
| 02   | Owner Checks（アカウント所有者の確認不足）          | 全ファイル                            | 対象 |
| 03   | Type Cosplay（型偽装攻撃）                          | 全ファイル                            | 対象 |
| 04   | Initialization（初期化不足）                         | 全ファイル                            | 対象 |
| 05   | Arbitrary CPI（任意のCPI呼び出し）                   | 全ファイル                            | 対象 |
| 06   | Duplicate Mutable Accounts（重複するmutableアカウント）| mutableアカウントを複数指定している箇所| 対象 |
| 07   | Bump Seed Canonicalization（バンプシード正規化漏れ）  | PDAを使用する全ファイル               | 対象 |
| 08   | PDA Sharing（PDA共有の脆弱性）                      | PDAを使用する全ファイル               | 対象 |
| 09   | Closing Accounts（アカウント閉鎖処理の不備）         | `close`属性またはアカウント削除処理が存在するファイル | 非対象 |
| 10   | Sysvar Address Checking（Sysvarアドレス検証不足）    | Sysvarアカウントを利用するファイル     | 非対象 |
| 11   | Instruction Data Validation（命令データ検証不足）    | 全ファイル                            | 対象 |
| 12   | CPI Data Injection（CPIデータ注入攻撃）             | CPI呼び出しをしているファイル         | 対象 |
| 13   | Rent-Exemption（Rent免除状態の確認不足）            | アカウント作成・初期化を行うファイル   | 対象 |
| 14   | Oracle Manipulation（オラクル操作）                  | オラクルデータを使用するファイル       | 非対象 |
| 15   | Immutable Data Bypass（不変データ書換）              | 全ファイル                            | 対象 |
| 16   | Program Upgrade Authority（アップグレード権限）      | （本シートでは対象外：別途確認）      | 非対象（固定）|
| 17   | External Dependency Vulnerabilities（外部依存脆弱性）| 外部プログラムを明示的に呼び出しているファイル | 対象 |
| 18   | Arithmetic Overflow/Underflow（算術オーバーフロー）   | 全ファイル                            | 対象 |
| 19   | Unsafe Code Misuse（unsafeコードの誤用）             | `unsafe`を利用しているファイル        | 非対象 |

## 攻撃ベクトルごとの監査プラン

### 攻撃ベクトル名
00. Signer Authorization（署名者の権限検証不足）

### 対象・非対象
対象

### 理由
- 全てのファイルでSignerアカウントを使用しており、適切な権限検証が必要
- 特にstaking-code.rsではunstake操作時に適切な署名者検証が不足している可能性がある
- action_processor.rsでは任意のプログラム呼び出しを行うため、署名者の権限検証が重要

### 対象ファイル
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/asset_manager.rs
- programs/vulnerability-code/data-manager.rs
- programs/vulnerability-code/profile_manager.rs
- programs/vulnerability-code/refferal_airdrop.rs
- programs/vulnerability-code/seed.rs
- programs/vulnerability-code/staking-code.rs

---

### 攻撃ベクトル名
01. Account Data Matching（アカウントデータ整合性）

### 対象・非対象
対象

### 理由
- 全てのファイルでアカウントデータを扱っており、データの整合性検証が必要
- 特にasset_manager.rsではトークンアカウントの整合性検証が重要
- data-manager.rsではデータアカウントの整合性検証が不足している可能性がある

### 対象ファイル
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/asset_manager.rs
- programs/vulnerability-code/data-manager.rs
- programs/vulnerability-code/profile_manager.rs
- programs/vulnerability-code/refferal_airdrop.rs
- programs/vulnerability-code/seed.rs
- programs/vulnerability-code/staking-code.rs

---

### 攻撃ベクトル名
02. Owner Checks（アカウント所有者の確認不足）

### 対象・非対象
対象

### 理由
- 全てのファイルでアカウントを扱っており、アカウント所有者の確認が必要
- 特にdata-manager.rsではアカウント所有者の検証が不足している可能性がある
- action_processor.rsでは任意のプログラム呼び出しを行うため、アカウント所有者の確認が重要

### 対象ファイル
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/asset_manager.rs
- programs/vulnerability-code/data-manager.rs
- programs/vulnerability-code/profile_manager.rs
- programs/vulnerability-code/refferal_airdrop.rs
- programs/vulnerability-code/seed.rs
- programs/vulnerability-code/staking-code.rs

---

### 攻撃ベクトル名
03. Type Cosplay（型偽装攻撃）

### 対象・非対象
対象

### 理由
- 特にdata-manager.rsではデータの型検証が不足している可能性がある
- try_from_sliceを使用してデータをデシリアライズしているが、型の検証が不十分

### 対象ファイル
- programs/vulnerability-code/data-manager.rs
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/asset_manager.rs
- programs/vulnerability-code/profile_manager.rs
- programs/vulnerability-code/refferal_airdrop.rs

---

### 攻撃ベクトル名
04. Initialization（初期化不足）

### 対象・非対象
対象

### 理由
- profile_manager.rsではinit_if_neededを使用してアカウントを初期化している
- seed.rsではinitを使用してアカウントを初期化している
- 初期化時のデータ検証が不足している可能性がある

### 対象ファイル
- programs/vulnerability-code/profile_manager.rs
- programs/vulnerability-code/seed.rs
- programs/vulnerability-code/staking-code.rs

---

### 攻撃ベクトル名
05. Arbitrary CPI（任意のCPI呼び出し）

### 対象・非対象
対象

### 理由
- action_processor.rsでは任意のプログラム呼び出しを行っており、セキュリティリスクが高い
- refferal_airdrop.rsではCPI呼び出しを行っている
- asset_manager.rsではトークン転送のためのCPI呼び出しを行っている

### 対象ファイル
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/refferal_airdrop.rs
- programs/vulnerability-code/asset_manager.rs

---

### 攻撃ベクトル名
06. Duplicate Mutable Accounts（重複するmutableアカウント）

### 対象・非対象
対象

### 理由
- refferal_airdrop.rsでは複数のmutableアカウントを使用している
- action_processor.rsでは複数のmutableアカウントを使用している
- 重複するmutableアカウントによる攻撃の可能性がある

### 対象ファイル
- programs/vulnerability-code/refferal_airdrop.rs
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/asset_manager.rs

---

### 攻撃ベクトル名
07. Bump Seed Canonicalization（バンプシード正規化漏れ）

### 対象・非対象
対象

### 理由
- seed.rsではバンプシードを使用してPDAを生成している
- profile_manager.rsではバンプシードを使用してPDAを生成している
- バンプシードの正規化が不足している可能性がある

### 対象ファイル
- programs/vulnerability-code/seed.rs
- programs/vulnerability-code/profile_manager.rs

---

### 攻撃ベクトル名
08. PDA Sharing（PDA共有の脆弱性）

### 対象・非対象
対象

### 理由
- seed.rsではPDAを使用している
- profile_manager.rsではPDAを使用している
- 異なるインストラクション間でPDAが共有される可能性がある

### 対象ファイル
- programs/vulnerability-code/seed.rs
- programs/vulnerability-code/profile_manager.rs

---

### 攻撃ベクトル名
09. Closing Accounts（アカウント閉鎖処理の不備）

### 対象・非対象
非対象

### 理由
- 対象ファイルにはアカウント閉鎖処理（close属性またはアカウント削除処理）が存在しない

### 対象ファイル
なし

---

### 攻撃ベクトル名
10. Sysvar Address Checking（Sysvarアドレス検証不足）

### 対象・非対象
非対象

### 理由
- 対象ファイルにはSysvarアカウントを直接利用する処理が存在しない

### 対象ファイル
なし

---

### 攻撃ベクトル名
11. Instruction Data Validation（命令データ検証不足）

### 対象・非対象
対象

### 理由
- 全てのファイルで命令データを扱っており、データの検証が必要
- 特にaction_processor.rsでは任意のデータを渡すため、データ検証が重要
- staking-code.rsではamountパラメータの検証が不足している可能性がある

### 対象ファイル
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/asset_manager.rs
- programs/vulnerability-code/data-manager.rs
- programs/vulnerability-code/profile_manager.rs
- programs/vulnerability-code/refferal_airdrop.rs
- programs/vulnerability-code/seed.rs
- programs/vulnerability-code/staking-code.rs

---

### 攻撃ベクトル名
12. CPI Data Injection（CPIデータ注入攻撃）

### 対象・非対象
対象

### 理由
- action_processor.rsでは任意のデータでCPI呼び出しを行っており、データ注入攻撃のリスクがある
- refferal_airdrop.rsではCPI呼び出しを行っている
- asset_manager.rsではトークン転送のためのCPI呼び出しを行っている

### 対象ファイル
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/refferal_airdrop.rs
- programs/vulnerability-code/asset_manager.rs

---

### 攻撃ベクトル名
13. Rent-Exemption（Rent免除状態の確認不足）

### 対象・非対象
対象

### 理由
- profile_manager.rsではアカウント初期化を行っており、Rent免除状態の確認が必要
- seed.rsではアカウント初期化を行っており、Rent免除状態の確認が必要

### 対象ファイル
- programs/vulnerability-code/profile_manager.rs
- programs/vulnerability-code/seed.rs

---

### 攻撃ベクトル名
14. Oracle Manipulation（オラクル操作）

### 対象・非対象
非対象

### 理由
- 対象ファイルにはオラクルデータを使用する処理が存在しない

### 対象ファイル
なし

---

### 攻撃ベクトル名
15. Immutable Data Bypass（不変データ書換）

### 対象・非対象
対象

### 理由
- 全てのファイルでデータを扱っており、不変データの保護が必要
- 特にstaking-code.rsではステーキング情報の保護が重要
- profile_manager.rsではプロファイル情報の保護が重要

### 対象ファイル
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/asset_manager.rs
- programs/vulnerability-code/data-manager.rs
- programs/vulnerability-code/profile_manager.rs
- programs/vulnerability-code/refferal_airdrop.rs
- programs/vulnerability-code/seed.rs
- programs/vulnerability-code/staking-code.rs

---

### 攻撃ベクトル名
16. Program Upgrade Authority（アップグレード権限）

### 対象・非対象
非対象（固定）

### 理由
- 本シートでは対象外として扱う（別途アカウント状況の監査で確認）

### 対象ファイル
なし

---

### 攻撃ベクトル名
17. External Dependency Vulnerabilities（外部依存脆弱性）

### 対象・非対象
対象

### 理由
- action_processor.rsでは外部プログラムを呼び出しており、外部依存脆弱性のリスクがある
- asset_manager.rsではトークンプログラムを呼び出している
- refferal_airdrop.rsではトークンプログラムを呼び出している

### 対象ファイル
- programs/vulnerability-code/action_processor.rs
- programs/vulnerability-code/asset_manager.rs
- programs/vulnerability-code/refferal_airdrop.rs

---

### 攻撃ベクトル名
18. Arithmetic Overflow/Underflow（算術オーバーフロー）

### 対象・非対象
対象

### 理由
- staking-code.rsでは算術演算を行っており、オーバーフロー/アンダーフローのリスクがある
- refferal_airdrop.rsでは算術演算を行っている
- seed.rsでは値の更新を行っている

### 対象ファイル
- programs/vulnerability-code/staking-code.rs
- programs/vulnerability-code/refferal_airdrop.rs
- programs/vulnerability-code/seed.rs

---

### 攻撃ベクトル名
19. Unsafe Code Misuse（unsafeコードの誤用）

### 対象・非対象
非対象

### 理由
- 対象ファイルにはunsafeキーワードを使用するコードが存在しない

### 対象ファイル
なし
