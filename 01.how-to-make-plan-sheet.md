# 監査プランシートの作成
まずは、監査実施の前に、監査プランシートの作成をしてください。
本シートでは、対象となるSolanaプログラムコードを監査する前段階として、各攻撃ベクトルが今回の監査範囲に含まれるかどうかを明確にします。


## ディレクトリとファイル作成
まずは監査プランシートは、  audit_report ディレクトリに、program のディレクトリを作り、その中にレポートを作ってください。

例 
```
mkdir audit_report/vulnerability-code/
touch audit_report/vulnerability-code/audit_plan_sheet.md
```

## 攻撃ベクトル監査プラン作成

次の攻撃ベクトルリスト（Anchorを使用したプログラムを前提）を利用し、
各攻撃ベクトルが監査対象になるかを判断し、『攻撃ベクトル監査プラン』を作成してください。


以下のフォーマットで修正しました。

---

### 監査項目リスト（Anchor向け）

以下の監査項目を元に、各攻撃ベクトルが今回の監査対象になるか判断し、「対象・非対象」列を記入してください。

| 番号 | 攻撃ベクトル名                                     | 対象条件                | 対象・非対象 |
|------|----------------------------------------------------|---------------------------------------|--------------|
| 00   | Signer Authorization（署名者の権限検証不足）        | 全ファイル                            | 対象・非対象 |
| 01   | Account Data Matching（アカウントデータ整合性）     | 全ファイル                            | 対象・非対象 |
| 02   | Owner Checks（アカウント所有者の確認不足）          | 全ファイル                            | 対象・非対象 |
| 03   | Type Cosplay（型偽装攻撃）                          | 全ファイル                            | 対象・非対象 |
| 04   | Initialization（初期化不足）                         | 全ファイル                            | 対象・非対象 |
| 05   | Arbitrary CPI（任意のCPI呼び出し）                   | 全ファイル                            | 対象・非対象 |
| 06   | Duplicate Mutable Accounts（重複するmutableアカウント）| mutableアカウントを複数指定している箇所| 対象・非対象 |
| 07   | Bump Seed Canonicalization（バンプシード正規化漏れ）  | PDAを使用する全ファイル               | 対象・非対象 |
| 08   | PDA Sharing（PDA共有の脆弱性）                      | PDAを使用する全ファイル               | 対象・非対象 |
| 09   | Closing Accounts（アカウント閉鎖処理の不備）         | `close`属性またはアカウント削除処理が存在するファイル | 対象・非対象 |
| 10   | Sysvar Address Checking（Sysvarアドレス検証不足）    | Sysvarアカウントを利用するファイル     | 対象・非対象 |
| 11   | Instruction Data Validation（命令データ検証不足）    | 全ファイル                            | 対象・非対象 |
| 12   | CPI Data Injection（CPIデータ注入攻撃）             | CPI呼び出しをしているファイル         | 対象・非対象 |
| 13   | Rent-Exemption（Rent免除状態の確認不足）            | アカウント作成・初期化を行うファイル   | 対象・非対象 |
| 14   | Oracle Manipulation（オラクル操作）                  | オラクルデータを使用するファイル       | 対象・非対象 |
| 15   | Immutable Data Bypass（不変データ書換）              | 全ファイル                            | 対象・非対象 |
| 16   | Program Upgrade Authority（アップグレード権限）      | （本シートでは対象外：別途確認）      | 非対象（固定）|
| 17   | External Dependency Vulnerabilities（外部依存脆弱性）| 外部プログラムを明示的に呼び出しているファイル | 対象・非対象 |
| 18   | Arithmetic Overflow/Underflow（算術オーバーフロー）   | 全ファイル                            | 対象・非対象 |
| 19   | Unsafe Code Misuse（unsafeコードの誤用）             | `unsafe`を利用しているファイル        | 対象・非対象 |

---

※ 監査者は、各攻撃ベクトルが監査対象となるかどうかコードを確認し、「対象・非対象」欄を記入してください。  
16番（アップグレード権限）は、本シートでは非対象として扱います（別途アカウント状況の監査で確認）。

### 攻撃ベクトルごとの監査プランを作成する

各攻撃ベクトルについて、以下のテンプレートに従い、「対象・非対象」「理由」「対象ファイル」を明記してください。

**攻撃ベクトル監査プラン記入テンプレート**

```
### 攻撃ベクトル名
（番号・攻撃ベクトル名を記入）

### 対象・非対象
（対象／非対象のどちらかを記入）

### 理由
（対象の場合は、監査対象とした理由を明記してください）
（非対象の場合は、監査不要の理由を明記してください）

### 対象ファイル
（対象の場合は具体的なファイル名を列挙してください）
（非対象の場合は「なし」と記載してください）
```

---

## 🚩 作成例（PDA Sharingの場合）

```
### 攻撃ベクトル名
08. PDA Sharing（PDA共有の脆弱性）

### 対象・非対象
対象

### 理由
- PDA（Program Derived Address）が複数箇所で利用されているため。
- 異なるインストラクションで同じPDAを利用している可能性があり、共有による衝突リスクが存在するため。

### 対象ファイル
- programs/src/state.rs
- programs/src/instructions/staking.rs
- programs/src/instructions/vault.rs
```

---

## 🗒️ 監査プラン作成にあたっての注意点

- 監査プランの段階ではコードをざっと読み、攻撃ベクトルの適用範囲を明確化することに集中してください。
- 具体的な脆弱性の発見・報告は次の監査フェーズで行いますので、ここでは範囲特定のみを行います。
- 「対象・非対象」と「理由」を明確にすることで、後の監査作業の効率化を図ります。

以上の手順で、監査プランシートを作成してください。